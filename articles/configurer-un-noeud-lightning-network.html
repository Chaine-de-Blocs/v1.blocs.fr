<!DOCTYPE HTML><html lang="fr" prefix="og: http://ogp.me/ns#"><head><title>Configurer son nÅ“ud Bitcoin Lightning Network</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#0070FC"/><meta name="author" content="Jonathan Serra"/><meta property="og:url" content="https://blocs.fr"/><meta property="og:title" content="Configurer son nÅ“ud Bitcoin Lightning Network"/><meta property="og:description" content="Dans l&#x27;article prÃ©cÃ©dent j&#x27;ai Ã©crit au sujet de l&#x27;installation d&#x27;un nÅ“ud Bitcoin Lightning Network avec un Raspberry Pi. Ce dernier est sommaire et va Ã  l&#x27;essentiel. Dans cet article il va s&#x27;agir d&#x27;optimiser la configuration du Raspberry Pi afin d&#x27;amÃ©liorer sa sÃ©curitÃ© et rendre l&#x27;administration moins laborieuse."/><meta name="description" content="Dans l&#x27;article prÃ©cÃ©dent j&#x27;ai Ã©crit au sujet de l&#x27;installation d&#x27;un nÅ“ud Bitcoin Lightning Network avec un Raspberry Pi. Ce dernier est sommaire et va Ã  l&#x27;essentiel. Dans cet article il va s&#x27;agir d&#x27;optimiser la configuration du Raspberry Pi afin d&#x27;amÃ©liorer sa sÃ©curitÃ© et rendre l&#x27;administration moins laborieuse."/><meta property="og:image" content="/res/d135126d.jpg"/><meta property="og:image:alt" content="Installer un noeud Bitcoin-Comment fonctionne bitcoin-Installer Bitcoin"/><meta property="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@_blocs"/><meta name="twitter:creator" content="@_blocs"/><meta property="article:author" content="Jonathan Serra"/><script defer="">const storageKey="blocs-data-theme";document.addEventListener("DOMContentLoaded",(function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;let t=window.localStorage.getItem(storageKey);t||(t=e?"dark":"light");const a=document.querySelector("#theme-switch");a&&(activateTheme(t,a),a.addEventListener("click",(()=>{switch(t){case"dark":t="light";break;default:t="dark"}window.localStorage.setItem(storageKey,t),activateTheme(t,a)})))}));const activateTheme=(e,t)=>{const a=t.childNodes[0],c=t.childNodes[1];switch(e){case"light":c.style.display="block",a.style.display="none";break;case"dark":default:c.style.display="none",a.style.display="block"}document.documentElement.setAttribute("data-theme",e)};</script><script src="/res/1699ad49.js" defer=""></script><style>@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:normal;font-named-instance:"Regular";src:url(/res/541fae2e.woff2);font-display:fallback}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:italic;font-named-instance:"Regular";src:url(/res/1517082.woff2);font-display:fallback}@font-face{font-family:'icons';font-display:swap;src:url(/res/31819284.woff2);font-weight:400;font-style:normal;font-display:fallback}.a:before,[class*=" icon-"]:before,[class^=icon-]:before{font-family:"icons";font-style:normal;font-weight:400;speak:never;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:border-box}*{font-weight:var(--b)}@supports (font-variation-settings:"wght" 400){*{font-weight:inherit;font-variation-settings:"wght" var(--b)}}:root{--a:#0070FC;--c:#FBE016;--d:white;--e:black;--f:#000F26;--g:#eee;--h:12px;--i:12px}::selection{background-color:var(--a);color:#fff}[data-theme=light]{--d:#111;--c:#E3CB14;--e:white;--f:#fefefe;--g:#333}body{margin:var(--h) var(--i) 64px;font:18px/26px Inter,system-ui,-apple-system,sans-serif;color:var(--d);background:var(--f);line-height:28px;max-width:100%;overflow-x:hidden}a{text-decoration:none;color:var(--a)}.w .y>div a:hover,a:active,a:hover{text-decoration:underline}.b a span{font-size:26px}.c{float:left;margin-left:-24px}a:active,a:focus,a:hover{text-decoration:underline}.d{display:flex;padding-top:12px;margin:-12px calc(-1*var(--i)) 48px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch}.d::after,.d::before{display:block;content:"";padding-right:var(--i)}.e,.f{flex:none;--b:700}.e{display:block;font-size:24px;line-height:18px;letter-spacing:-1px;text-transform:lowercase;border-top:4px solid;padding:6px 4px 0 0}a.e{color:currentColor;text-decoration:none}.f{margin:0 0 0 24px;font-size:6px;line-height:10px;letter-spacing:1px;text-transform:uppercase;width:0}.g{margin-left:auto}.h{flex:none;display:block;margin:10px 24px 0 0;font-size:14px;color:var(--d);--b:600;line-height:18px}.h:last-child{margin-right:0}a.i,a.i.j{color:var(--d)}a.i{display:block;cursor:pointer;font-size:16px;min-width:125px;margin:0 auto;padding:13px;text-decoration:none;border:1px solid var(--d);border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}a.i.j{background-color:var(--a);border-color:var(--a)}#isso-thread input[type=button]:hover,#isso-thread input[type=submit]:hover,a.i:hover{transform:translate(-2px,-2px);box-shadow:2px 2px 1px var(--g)}#isso-thread input[type=button]:active,#isso-thread input[type=submit]:active,a.i:active{transform:translate(0,0);box-shadow:inset 0 0 7px var(--g)}@media (min-width:768px){:root{--i:64px}}@media (min-width:1024px){:root{--i:128px}}.k:before{content:'\f16d'}.l:before{content:'\f300'}.n:before{content:'\f167'}.m:before{content:'\f30c'}.o:before{content:'\f2c6'}.p:before{content:'\E800'}.q:before{content:'\F186'}:root{--i:max(12px, (100vw - var(--j)) / 2);--j:800px}h1{margin:48px 0 32px;font-size:36px;line-height:48px;letter-spacing:-.8px}h2,h3{margin:42px 0 18px}h1,h2{font-weight:700}h2{font-size:26px;line-height:34px;letter-spacing:-.3px}h3{font-size:22px;line-height:30px;letter-spacing:-.18px}p{margin:18px 0}p>code{word-break:break-all}blockquote code,em>code{font-style:normal}.r a,h3,strong{font-weight:600}ul.r{margin:24px 0;padding-left:32px;margin-left:calc(-32*min(max(var(--i) - 32px,0px),1px))}.r a{color:var(--d)}.r li{display:flex;flex-direction:row;position:relative;list-style:none;margin:2px 0 30px}.r picture{margin-top:5px;margin-right:20px}.r picture *{border-radius:5px}#isso-thread #isso-root .O,.s,.w .y>div{margin:0}.t{font-size:16px;margin:5px 0}i{font-size:14px}blockquote{line-height:32px;font-weight:300;font-style:italic}table{margin:24px;border-collapse:separate;border-spacing:12px 0}thead th{border-bottom:var(--k) solid;--b:600;text-align:left}code,pre code{background-color:var(--e)}code{font-size:.9em;font-family:monospace;padding:1px 5px;border:1px dotted var(--c);border-radius:4px}pre code{display:block;width:100vw;margin:48px calc(-1*var(--i));padding:18px var(--i);border-width:0;border-radius:0;overflow-x:scroll}video{display:block;max-width:100%;margin:32px auto}iframe{width:calc(var(--l)*1);height:calc(var(--l)*.66);border:1px solid rgba(0,0,0,.1);--l:calc(100vw - 2 * var(--i))}.u,blockquote{color:#9e9e9e}.v{cursor:pointer}.w{display:flex;flex-wrap:wrap-reverse}.w .x>p{padding-top:0;margin-top:0}.w .y .z{margin-bottom:7px}.w .x{flex:1;margin-right:15px;width:400px}.w .y{padding:17px;background-color:var(--e);border-radius:4px;overflow:hidden;max-width:350px}.w .y h2{color:var(--d);margin:0 0 10px}.w .y>div div{margin-left:20px}.w .y>div a{display:block;text-decoration:none}.A,.w .y{box-shadow:7px 10px 15px rgba(10,10,10,.2)}.A .B{height:10px;width:10px;border-radius:50%;border:1px solid #000;position:relative;top:6px;left:6px;background-color:#ff3b47;border-color:#9d252b;display:inline-block;vertical-align:top}.B.C{left:11px;background-color:#ffc100;border-color:#9d802c}.B.D{left:16px;background-color:#00d742;border-color:#049931}.A .E{position:relative;width:100%;height:25px;background-color:#bbb;margin:0 auto;border-top-right-radius:5px;border-top-left-radius:5px}.A .F,.A .G{display:inline-block}.A .F{position:absolute}.A .G{color:#333;width:100%;padding:0;margin:0;text-align:center;font-size:12px;font-weight:700;vertical-align:top;line-height:25px}.A .H{background-color:#000;color:#fff;box-sizing:border-box;width:100%;margin:0 auto;padding:20px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;font-size:16px}.A .I{font-family:monospace!important;padding:0;margin:0}.A .J{color:var(--c);font-weight:700;margin-right:7px}.A .K{background-color:#fff}.A i{color:#666}#isso-thread h4{display:none}#isso-thread input[type=button],#isso-thread input[type=submit]{cursor:pointer;font-size:16px;width:125px;margin:0 auto;color:var(--d);padding:13px;text-decoration:none;border:1px solid #fff;border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}#isso-thread input[type=submit]{background-color:var(--a);border-color:var(--a);color:#fff}#isso-thread input[type=checkbox]{margin-right:6px}#isso-thread>div>div>div>div,.A .K{color:#000}#isso-thread code,#isso-thread label{color:#fff}#isso-thread h1,#isso-thread h2,#isso-thread h3,#isso-thread h4,#isso-thread h5,#isso-thread h6{margin:0;line-height:1em}#isso-thread h1{font-size:2em}#isso-thread h2{font-size:1.6}#isso-thread h3{font-size:1.2}#isso-thread input[type=email],#isso-thread input[type=text]{margin-bottom:15px;padding:10px 0 10px 10px;background-color:transparent;border:0;border-bottom:1px solid #fff;border-radius:0;outline-color:var(--g);color:#fff;margin-right:10px}#isso-thread .L::placeholder,#isso-thread input[type=email]::placeholder,#isso-thread input[type=text]::placeholder{color:#bbb}#isso-thread .L::active,#isso-thread .L:focus,#isso-thread input[type=email]:active,#isso-thread input[type=email]:focus,#isso-thread input[type=text]:active,#isso-thread input[type=text]:focus{border-color:var(--a)!important}#isso-thread input[name=website]{display:none}#isso-thread .M{margin-top:30px}#isso-thread .M>.N{padding-right:15px}#isso-thread preview{background:0 0;border:0;box-shadow:none}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{min-height:100px!important;font-size:14px}#isso-thread #isso-root b,#isso-thread #isso-root h1,#isso-thread #isso-root h2,#isso-thread #isso-root h3,#isso-thread #isso-root i,#isso-thread #isso-root p,#isso-thread #isso-root strong{color:var(--d)}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{max-height:1.5em}#isso-thread #isso-root .P{color:#fff!important}.Q h2{margin-bottom:0;padding-bottom:0}.Q p{margin-top:0}.Q i{font-size:14px}@media (min-width:768px){a,p>code{word-break:initial}}@media (max-width:484px){.r li{flex-direction:column}.r li img{width:100%}.r{padding:0 15px!important}.r picture{margin-bottom:10px;margin-right:0}.c{margin-left:0;margin-right:8px}}.U,.V{color:#a0a1a7;font-style:italic}.W,.X,.Y{color:#a626a4}.-a,.-b,.-c,.Z,._{color:#e45649}.-d{color:#0184bb}.-e,.-f,.-g,.-h,.-i{color:#50a14f}.-j,.-k .-l{color:#c18401}.-m,.-n,.-o,.-p,.-q,.-r,.-s,.-t{color:#986801}.-l,.-u,.-v,.-w,.-x,.-y{color:#4078f2}.-z{font-style:italic}.-A{font-weight:700}.-w{text-decoration:underline}@media (prefers-color-scheme:dark){.U,.V{color:#5c6370;font-style:italic}.W,.X,.Y{color:#c678dd}.-a,.-b,.-c,.Z,._{color:#e06c75}.-d{color:#56b6c2}.-e,.-f,.-g,.-h,.-i{color:#98c379}.-j,.-k .-l{color:#e6c07b}.-m,.-n,.-o,.-p,.-q,.-r,.-s,.-t{color:#d19a66}.-l,.-u,.-v,.-w,.-x,.-y{color:#61aeee}.-z{font-style:italic}.-A{font-weight:700}.-w{text-decoration:underline}}.-B{padding:0 8px;vertical-align:top;cursor:pointer;color:var(--a)}.-B:hover{text-decoration:underline}.-C{position:absolute;opacity:0;color:#fff;font-weight:700;background-color:var(--a);padding:5px 10px;margin-left:10px;border-radius:6px;font-size:14px;transition:123ms}</style><script defer="">document.documentElement.style.setProperty("--k",1/(window.devicePixelRatio||1)+"px");</script></head><body><div class="d"><a href="/" class="e">Blocs<br/>.fr</a><div class="f">Site</div><a href="/" class="h">Home</a><div class="f g">Cool</div><a href="/blog" class="h">Blog</a><a href="#" class="h" id="theme-switch"><span class="a p"></span><span class="a q"></span></a></div><div class="w"><div class="x"><p><a href="/articles/installer-un-noeud-lightning-network" target="_blank">Dans l&#x27;article prÃ©cÃ©dent</a> j&#x27;ai Ã©crit au sujet de l&#x27;installation d&#x27;un nÅ“ud Bitcoin Lightning Network avec un Raspberry Pi. Ce dernier est sommaire et va Ã  l&#x27;essentiel. Dans cet article il va s&#x27;agir d&#x27;optimiser la configuration du Raspberry Pi afin d&#x27;amÃ©liorer sa sÃ©curitÃ© et rendre l&#x27;administration moins laborieuse.</p></div><div class="y"><h2>Sommaire</h2><div class="z"><a href="#fixer-ladresse-ip-locale-du-n%C5%93ud">Fixer l&#x27;adresse IP locale du nÅ“ud</a></div><div class="z"><a href="#s%C3%A9curiser-les-acc%C3%A8s-distants-ssh">SÃ©curiser les accÃ¨s distants SSH</a></div><div class="z"><a href="#enregistrer-votre-cl%C3%A9-pour-les-connexions-futures">Enregistrer votre clÃ© pour les connexions futures</a></div><div class="z"><a href="#ajouter-une-couche-suppl%C3%A9mentaire--lauthentification-ssh">Ajouter une couche supplÃ©mentaire Ã  l&#x27;authentification SSH</a></div><div class="z"><a href="#activer-le-red%C3%A9marrage-automatique-des-services">Activer le redÃ©marrage automatique des services</a><div><div class=""><a href="#bitcoind">bitcoind</a></div><div class=""><a href="#lnd">lnd</a></div></div></div></div></div><p><em>Notez que tout ce qui va suivre devra se faire avec lâ€™utilisateur administrateur. Pour sâ€™y connecter tapez une fois <code>su root</code> puis tapez son mot de passe.</em></p><h2 id="fixer-ladresse-ip-locale-du-n%C5%93ud" class="S"><a href="#fixer-ladresse-ip-locale-du-n%C5%93ud" class="c">Â§</a>Fixer lâ€™adresse IP locale du nÅ“ud</h2><p><em>Ce qui suit sâ€™applique quâ€™aux connexions rÃ©seau filaire et non Wifi</em></p><p>Votre nÅ“ud possÃ¨de une adresse IP locale afin dâ€™Ãªtre accÃ©ssible dans votre rÃ©seau, câ€™est dâ€™ailleurs grÃ¢ce Ã  cette derniÃ¨re que vous pouvez y accÃ©der avec SSH. Cependant il est fort probable que son adressage se fasse dynamiquement par dÃ©faut, par consÃ©quent lâ€™adresse de votre Raspberry pourrait changer. Il est prÃ©fÃ©rable dâ€™Ã©viter cette inconvenance alors on va forcer une adresse IP statique.</p><p>Ouvrez le fichiers de configuration DHCP en tapant <code>nano /etc/dhcpcd.conf</code>, ajoutez Ã  la fin du fichier ces informations :</p><pre><code>interface eth0
static ip_address=192.168.1.42/24 # C&#x27;est l&#x27;IP qu&#x27;aura la machine
static routers=&lt;Votre passerelle&gt; # Passerelle, explications plus bas
static domain_name_servers=&lt;Votre passerelle&gt; 8.8.8.8
</code></pre><p>Ici vous allez devoir faire un travail dâ€™enquÃªte pour connaÃ®tre votre rÃ©seau et savoir quelle est la passerelle. Suivez le terminal ci-dessous :</p><div class="A"><div class="E"><div class="F"><div class="B -D"></div><div class="B C"></div><div class="B D"></div></div><p class="G">Trouver l&#x27;adresse IP de la passerelle</p></div><div class="H"><div class="I"><span class="J">pi@raspberrypi:~ $</span><span class="-B cliboard-action-selector" data-value="g1hsohkn7t_0">ğŸ“‹</span><span id="g1hsohkn7t_0">ip route</span><span id="g1hsohkn7t_0_copy-result" class="-C">C&#x27;est copiÃ© !</span><div>default via <span class="K">192.168.1.1</span> dev eth0 src 192.168.1.42 metric 202</div><div>192.168.1.0<span class="K">/24</span> dev eth0 proto kernel scope link src 192.168.1.42 metric 202</div></div></div></div><p>TrouvÃ© ! <code>192.168.1.1</code> est la passerelle de mon rÃ©seau, câ€™est ce que vous devez mettre dans la configuration DHCP plus haut. Notez Ã©galement le <code>/24</code> qui est un masque de rÃ©seau et que vous devez aussi utiliser dans votre configuration DHCP.</p><blockquote><p>Sans entrer dans les dÃ©tails le masque <code>/24</code> (ou <code>/n</code>) est ce qui va dÃ©terminer la plage dâ€™adresses disponibles. Avec une adresse type <code>192.168.1.0/24</code> vous avez 254 adresses disponibles allant de <code>192.168.1.1</code> Ã  <code>192.168.1.254</code>. Câ€™est important Ã  considÃ©rer car cela signifie que vous ne pouvez pas mettre nâ€™importe quelle adresse, il est important de respecter le format. Pour Ãªtre sÃ»r de ne pas vous tromper, conservez les 3 premiers chiffres de lâ€™IP et choisissez le dernier : <code>x.x.x.y</code> oÃ¹ â€œxâ€ sont les valeurs de base de lâ€™IP (<code>192.168.1</code> selon lâ€™exemple) et â€œyâ€ est une valeur choisie arbitrairement et comprise entre 1 et 254.</p></blockquote><p>Votre nÅ“ud a maintenant une IP statique.</p><h2 id="s%C3%A9curiser-les-acc%C3%A8s-distants-ssh" class="S"><a href="#s%C3%A9curiser-les-acc%C3%A8s-distants-ssh" class="c">Â§</a>SÃ©curiser les accÃ¨s distants SSH</h2><p>SSH est un protocole de rÃ©seau qui vous permet de vous connecter Ã  distance sur une machine grÃ¢ce Ã  un canal chiffrÃ©. Cela signifie que la machine distante exÃ©cute un service qui reÃ§oit les connexions SSH, ce service sâ€™appelle <code>sshd</code>. SSH en lui mÃªme est plutÃ´t bien sÃ©curisÃ©, cependant il est possible de couvrir un peu mieux les accÃ¨s.</p><p>Sans plus attendre trouvez le fichier en tapant <code>sudo nano /etc/ssh/sshd_config</code>.</p><p>Voyons quelles modifications vous pouvez apporter afin de mieux sÃ©curiser les accÃ¨s SSH. Vous noterez que la plupart des lignes sont commentÃ©es grÃ¢ce au caractÃ¨re â€#â€, cela signifie juste que les lignes comportant ce symbole au dÃ©but sont neutralisÃ©es, le travail consiste essentiellement Ã  dÃ©-neutraliser certaines lignes.</p><p><code>Port 2310</code> : Mettez le port que vous souhaitez, le changer est toujours une couche de sÃ©curitÃ© peu coÃ»teuse. Ici jâ€™ai mis 2310.</p><p><code>LoginGraceTime 2m</code> : Limite le temps de connexion inactif Ã  2 minutes. Vous pouvez lâ€™augmenter mais le plus bas le mieux.</p><p><code>StrictModes yes</code> : Assure les accÃ¨s aux fichiers en fonction de lâ€™utilisateur connectÃ©.</p><p><code>PermitRootLogin no</code> : Mettez PermitRootLogin Ã  <code>no</code>, cette option bloquera les connexions SSH Ã  lâ€™utilisateur administrateur du Raspberry. Si vous avez suivi <a href="/articles/installer-un-noeud-lightning-network" class="-E" target="_blank">lâ€™installation que je recommande</a> vous avez un utilisateur nommÃ© <code>bitcoin</code> qui a pour rÃ´le dâ€™administrer les services bitcoind et lnd. Câ€™est sur ce dernier que vous vous connecterez via SSH et non sur lâ€™utilisateur root.</p><p><code>MaxAuthTries 3</code> : Nombre dâ€™essais pour se connecter via SSH limitÃ© Ã  3. Cela bloque les attaques par brute force automatisÃ©.</p><p><code>MaxSessions 1</code> : Si vous Ãªtes la seule personne Ã  gÃ©rer votre machine, et que vous ne comptez pas crÃ©er plusieurs connexions SSH simultanÃ©es, alors limitez le nombre de sessions Ã  1. Il faut garder ce nombre le plus petit possible en fonction de vos besoins.</p><p><code>PubkeyAuthentication yes</code> : Cette option vous servira plus tard. Elle nâ€™ajoute pas de sÃ©curitÃ© supplÃ©mentaire, câ€™est une option qui vous facilitera lâ€™accÃ¨s Ã  votre machine.</p><p>Tapez CTRL + O et CTRL + X; et enfin redÃ©marrez SSHd afin dâ€™appliquer ces modifications en tapant <code>sudo service sshd restart</code>.</p><h3 id="enregistrer-votre-cl%C3%A9-pour-les-connexions-futures" class="S"><a href="#enregistrer-votre-cl%C3%A9-pour-les-connexions-futures" class="c">Â§</a>Enregistrer votre clÃ© pour les connexions futures</h3><p>Dans la configuration prÃ©cÃ©dente vous aviez activÃ© lâ€™option PubkeyAuthentication, cette option va vous permettre dâ€™enregistrer la clÃ© publique de votre machine sur le Raspberry. Cela vous Ã©vitera de taper sans cesse le mot de passe de connexion.</p><p>Cela se passe en un commande. Suivez le terminal ci-dessous. Notez que cela doit se faire depuis votre machine locale (votre mac, votre pc, etc). Si vous Ãªtes sur Windows vous nâ€™aurez pas cette commande.</p><div class="A"><div class="E"><div class="F"><div class="B -D"></div><div class="B C"></div><div class="B D"></div></div><p class="G">Enregistrer se clÃ© publique SSH</p></div><div class="H"><div class="I"><span class="J">monpc@oumonmac:~ $</span><span class="-B cliboard-action-selector" data-value="gct8luq35a_0">ğŸ“‹</span><span id="gct8luq35a_0">ssh-copy-id -i ~/.ssh/id_rsa.pub bitcoin@192.168.1.42</span><span id="gct8luq35a_0_copy-result" class="-C">C&#x27;est copiÃ© !</span></div></div></div><p>Ensuite vous devrez taper le mot de passe de lâ€™utilisateur â€œbitcoinâ€. Notez que lâ€™IP <code>192.168.1.42</code> (<a href="/articles/installer-un-noeud-lightning-network#ifconfig" class="-E" target="_blank">comment trouver lâ€™IP de mon nÅ“ud ?</a>) doit Ãªtre lâ€™IP de votre nÅ“ud distant. Cette action aura pour effet de recenser la clÃ© publique de votre machine dans le Raspberry Pi, il vous reconnaÃ®tra pour les connexions futures et ne vous demandera plus de mot de passe.</p><blockquote><p>Si vous Ãªtes sur Windows en utilisant PuTTy, vous pouvez gÃ©nÃ©rer et trouver votre clÃ© publique avec <a href="https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/create-with-putty/" class="-E" target="_blank">PuTTyGen</a>. Copiez cette clÃ© qui commence par â€œssh-rsaâ€ si vous lâ€™avez crÃ©Ã© avec le chiffrement RSA. Cliquez sur â€œSave private keyâ€ et enregistrez le fichier sur votre machine. Revenez sur PuTTy, sur le panneau de gauche trouvez â€œConnection / SSH / Authâ€ puis dans la section â€œPrivate key file for authenticationâ€ chargez le fichier de votre clÃ© privÃ©e, câ€™est un fichier .ppk. Connectez vous Ã  votre Raspberry en utilisant PuTTy. Une fois connectÃ© tapez <code>sudo nano .ssh/authorized_keys</code> et collez la clÃ© publique que vous aviez copiÃ©, puis sauvegardez le fichier. Câ€™est terminÃ© dÃ©sormais votre Raspberry connaÃ®t votre clÃ© publique et autorisera les connexions futures depuis votre machine Windows.</p></blockquote><h2 id="ajouter-une-couche-suppl%C3%A9mentaire--lauthentification-ssh" class="S"><a href="#ajouter-une-couche-suppl%C3%A9mentaire--lauthentification-ssh" class="c">Â§</a>Ajouter une couche supplÃ©mentaire Ã  lâ€™authentification SSH</h2><p>Pour lâ€™instant il est toujours possible de forcer lâ€™accÃ¨s Ã  votre nÅ“ud avec une attaque par dictionnaire, qui consiste Ã  tester des millions de mot de passe jusquâ€™Ã  trouver un accÃ¨s. Il existe un service nommÃ© <code>fail2ban</code> qui va permettre de protÃ©ger en limitant les tentatives de connexion.</p><p>Pour lâ€™installer tapez <code>apt-get update &amp;&amp; apt-get install -y fail2ban</code>. Ensuite vous allez devoir configurer une chose si vous avez modifiÃ© le port SSH comme je lâ€™ai montrÃ© <a href="#securiser-ssh">juste au dessus</a>. Cherchez le fichier de configuration de fail2ban <code>nano /etc/fail2ban/jail.d/defaults-debian.conf</code>. Voyez la section <code>[sshd]</code> mettez ce qui suit (si vous nâ€™avez rien dans le fichier, ajoutez Ã©galement ce qui suit) :</p><pre><code>[sshd]
enabled = true
port    = 2310 # Notez que c&#x27;est le port que j&#x27;ai mis plus haut dans sshd_config
</code></pre><p>Sauvegardez en tapant CTRL + O et CTRL + X pour fermer et enfin tapez <code>systemctl restart fail2ban</code>.</p><blockquote><p>fail2ban est un service polyvalent qui sÃ©curise nombreuse authentifications, dont le service sshd et nous lâ€™utilisons pour Ã§a.</p></blockquote><h2 id="activer-le-red%C3%A9marrage-automatique-des-services" class="S"><a href="#activer-le-red%C3%A9marrage-automatique-des-services" class="c">Â§</a>Activer le redÃ©marrage automatique des services</h2><p>Cette partie est cruciale. Si votre Raspberry est redÃ©marrÃ© Ã  cause dâ€™une coupure de courant par exemple, il redÃ©marreraâ€¦ Mais il ne relancera pas bitcoind ni lnd. Ce qui aurait pour effet dâ€™Ã©teindre le service et vous obliger Ã  intervenir pour quâ€™il persÃ©vÃ¨re.</p><p>Dâ€™abord il va falloir faire en sorte que le disque soit toujours montÃ© sur le dossier .bitcoin car câ€™est ce dernier qui recense la blockchain et bitcoind en a besoin. Le montage de disque ne se fait jamais automatiquement. Alors voilÃ  comment configurer cela :</p><div class="A"><div class="E"><div class="F"><div class="B -D"></div><div class="B C"></div><div class="B D"></div></div><p class="G">Activer l&#x27;automount</p></div><div class="H"><div class="I"><span class="J">pi@raspberry:~ $</span><span class="-B cliboard-action-selector" data-value="gfwrfg4dvh_0">ğŸ“‹</span><span id="gfwrfg4dvh_0">df -h</span><span id="gfwrfg4dvh_0_copy-result" class="-C">C&#x27;est copiÃ© !</span><div>Filesystem      Size  Used Avail Use% Mounted on</div><div>/dev/root        15G  5.6G  8.4G  40% /</div><div>devtmpfs        460M     0  460M   0% /dev</div><div>tmpfs           464M     0  464M   0% /dev/shm</div><div>tmpfs           464M   12M  452M   3% /run</div><div>tmpfs           5.0M  4.0K  5.0M   1% /run/lock</div><div>tmpfs           464M     0  464M   0% /sys/fs/cgroup</div><div>/dev/mmcblk0p1   44M   22M   22M  51% /boot</div><div><span class="K">/dev/sda        458G  253G  182G  59% /home/bitcoin/.bitcoin</span></div><div>tmpfs            93M     0   93M   0% /run/user/1001</div></div><div class="I"><span class="J">pi@raspberry:~ $</span><span class="-B cliboard-action-selector" data-value="gfwrfg4dvh_1">ğŸ“‹</span><span id="gfwrfg4dvh_1">echo &#x27;/dev/sda /home/bitcoin/.bitcoin ext4 defaults,noatime 0 0&#x27; &gt;&gt; /etc/fstab</span><span id="gfwrfg4dvh_1_copy-result" class="-C">C&#x27;est copiÃ© !</span></div></div></div><p>Soyez vigilant ici. Jâ€™ai surlignÃ© mon montage actuel qui est <code>/dev/sda</code> montÃ© sur <code>/home/bitcoin/.bitcoin</code>, vous devez mettre ce chemin dans le <code>echo</code> en dessous. Notez Ã©galement lâ€™annotation <code>ext4</code> qui est le systÃ¨me de fichier que jâ€™ai choisi lorsque jâ€™avais formatÃ© le disque. Si vous avez un doute suivez le terminal ci-dessous</p><div class="A"><div class="E"><div class="F"><div class="B -D"></div><div class="B C"></div><div class="B D"></div></div><p class="G">Trouver le systÃ¨me de fichier d&#x27;un disque</p></div><div class="H"><div class="I"><span class="J">pi@raspberry:~ $</span><span class="-B cliboard-action-selector" data-value="gn4ietej2a_0">ğŸ“‹</span><span id="gn4ietej2a_0">file -sL /dev/sda</span><span id="gn4ietej2a_0_copy-result" class="-C">C&#x27;est copiÃ© !</span><div>/dev/sda: Linux rev 1.0 <span class="K">ext4</span> filesystem data, UUID=a2a0ec66-f768-4cf0-9442-6c2878ab60e1, volume name BLOCK-STORAGE (needs journal recovery) (extents) (64bit) (large files) (huge files)</div></div></div></div><p>OÃ¹ <code>/dev/sda</code> est mon disque Ã  monter. On voit en surlignÃ© <code>ext4</code> qui est le systÃ¨me de fichier.</p><h3 id="bitcoind" class="S"><a href="#bitcoind" class="c">Â§</a>bitcoind</h3><p>Le redÃ©marrage automatique dâ€™un service sur Linux se fait toujours de la mÃªme maniÃ¨re, il faut Ã©crire le service. Et pour ce faire tapez <code>nano /etc/systemd/system/bitcoind.service</code> et entrez la configuration suivante :</p><pre><code>[Unit]
Description=Bitcoin daemon
After=network.target

[Service]
ExecStartPre=/bin/sh -c &#x27;sleep 30&#x27;
ExecStart=/usr/local/bin/bitcoind -daemon -conf=/home/bitcoin/.bitcoin/bitcoin.conf -pid=/home/bitcoin/.bitcoin/bitcoind.pid # Mettez le chemin vers votre dossier .bitcoin
PIDFile=/home/bitcoin/.bitcoin/bitcoind.pid # Mettez le chemin vers votre dossier .bitcoin
User=bitcoin # Votre utilisateur qui gÃ¨re le service
Group=bitcoin # Votre groupe qui gÃ¨re le service
Type=forking
KillMode=process
Restart=always
TimeoutSec=120
RestartSec=30

[Install]
WantedBy=multi-user.target
</code></pre><p>CTRL + O et CTRL + X pour enregistrer et quitter puis tapez <code>systemctl enable bitcoind</code>. La machine est lancÃ©e, le service bitcoind dÃ©marrera au lancement du Raspberry.</p><h3 id="lnd" class="S"><a href="#lnd" class="c">Â§</a>lnd</h3><p>Encore une fois, il faut crÃ©er un service pour le service de lightning network, tapez <code>nano /etc/systemd/system/lnd.service</code> et voilÃ  la configuration que je recommande :</p><pre><code>[Unit]
Description=LND
Wants=bitcoind.service
After=bticoind.service # Il dÃ©marre aprÃ¨s bitcoind

[Service]
ExecStart=/usr/local/bin/lnd

User=bitcoin # Votre utilisateur qui gÃ¨re le service
Group=bitcoin # Votre utilisateur qui gÃ¨re le service
Type=simple
KillMode=process
LimitNOFILE=128000
TimeoutSec=300
Restart=always
RestartSec=120

[Install]
WantedBy=multi-user.target
</code></pre><p>Et enfin pour lâ€™activer <code>systemctl enable lnd</code>.</p><hr/><p>FÃ©licitations, votre Raspberry est autonome, il relancera les services en cas de redÃ©marrage inopinÃ©, sans votre aide, tout seul comme un grand.</p><p>Dans un article futur on va voir comment on peut administrer son nÅ“ud avec une interface graphique !</p><span class="u">ModifiÃ© le  <time dateTime="2019-04-24T00:00:00.000Z">mercredi 24 avril 2019</time></span><section class="T"><p><i>Cet article est sous license <a href="https://creativecommons.org/licenses/?lang=fr-FR" target="_blank">Creative Commons BY-NC-SA</a>. Il est ouvert Ã  contribution en vous rendant sur ce lien : <a href="https://github.com/Chaine-de-Blocs/blocs.fr/blob/master/posts/2019-04-24-configurer-un-noeud-lightning-network.mdx" target="_blank">Configurer son nÅ“ud Bitcoin Lightning Network</a></i></p></section><script type="text/javascript" data-isso="https://isso.blocs.fr/" src="//isso.blocs.fr/js/embed.min.js" data-isso-css="true" data-isso-lang="fr" data-isso-reply-notifications="true" async=""></script><div class="Q"><h2>Commentaires</h2><p><i>(Le format <a href="https://www.christopheducamp.com/2014/09/18/love-markdown/" target="_blank">Markdown</a> est acceptÃ©)</i></p><section id="isso-thread"></section></div></body></html>