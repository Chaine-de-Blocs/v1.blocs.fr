<!DOCTYPE HTML><html lang="fr" prefix="og: http://ogp.me/ns#"><head><title>Servir Bitcoin et Lightning Network en √©tant anonyme avec Tor</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#0070FC"/><meta name="author" content="Jonathan Serra"/><meta property="og:url" content="https://blocs.fr"/><meta property="og:title" content="Servir Bitcoin et Lightning Network en √©tant anonyme avec Tor"/><meta property="og:description" content="Vous avez un n≈ìud Bitcoin et Lightning Network, vous participez √† la d√©centralisation du r√©seau, bravo ! Cependant il r√©side un point noir, en particulier si votre noeud est localis√© chez vous ou votre bureau... En connaissant votre adresse IP, publi√©e par le noeud, il est possible de vous localiser. On rem√©die √† cela avec Tor."/><meta name="description" content="Vous avez un n≈ìud Bitcoin et Lightning Network, vous participez √† la d√©centralisation du r√©seau, bravo ! Cependant il r√©side un point noir, en particulier si votre noeud est localis√© chez vous ou votre bureau... En connaissant votre adresse IP, publi√©e par le noeud, il est possible de vous localiser. On rem√©die √† cela avec Tor."/><meta property="og:image" content="/res/5d444598.png"/><meta property="og:image:alt" content="Installer un noeud Bitcoin-Comment fonctionne bitcoin-Installer Bitcoin"/><meta property="og:type" content="blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@_blocs"/><meta name="twitter:creator" content="@_blocs"/><meta property="article:author" content="Jonathan Serra"/><script defer="">var storageKey="blocs-data-theme";function activateTheme(e,t){switch(e){case"light":t.innerHTML="Activer le mode sombre",document.documentElement.setAttribute("data-theme","light");break;case"dark":default:t.innerHTML="Activer le mode clair",document.documentElement.setAttribute("data-theme","dark")}}document.addEventListener("DOMContentLoaded",(function(){let e=localStorage.getItem(storageKey);const t=document.querySelector("#theme-switch");t&&(activateTheme(e,t),t.addEventListener("click",(function(){switch(e){case"dark":e="light";break;default:e="dark"}localStorage.setItem(storageKey,e),activateTheme(e,t)})))}));</script><script src="/res/1699ad49.js" defer=""></script><style>@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:normal;font-named-instance:"Regular";src:url(/res/541fae2e.woff2);font-display:fallback}@font-face{font-family:Inter;font-weight:100 900;font-display:swap;font-style:italic;font-named-instance:"Regular";src:url(/res/1517082.woff2);font-display:fallback}@font-face{font-family:'socials';font-display:swap;src:url(/res/520d5850.woff2);font-weight:400;font-style:normal;font-display:fallback}.a:before,[class*=" icon-"]:before,[class^=icon-]:before{font-family:"socials";font-style:normal;font-weight:400;speak:never;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:border-box}*{font-weight:var(--b)}@supports (font-variation-settings:"wght" 400){*{font-weight:inherit;font-variation-settings:"wght" var(--b)}}:root{--a:#0070FC;--c:#FBE016;--d:white;--e:black;--f:#000F26;--g:#eee;--h:12px;--i:12px}::selection{background-color:var(--a);color:#fff}@media (prefers-color-scheme:light){:root{--d:#111;--c:#E3CB14;--e:white;--f:#fefefe;--g:#333}}[data-theme=light]{--d:#111;--c:#E3CB14;--e:white;--f:#fefefe;--g:#333}body{margin:var(--h) var(--i) 64px;font:18px/26px Inter,system-ui,-apple-system,sans-serif;color:var(--d);background:var(--f);line-height:28px;max-width:100%;overflow-x:hidden}a{text-decoration:none;color:var(--a)}.t .v>div a:hover,a:active,a:hover{text-decoration:underline}.b a span{font-size:26px}.b a{color:var()}.c{float:left;margin-left:-24px}a:active,a:focus,a:hover{text-decoration:underline}.d{display:flex;padding-top:12px;margin:-12px calc(-1*var(--i)) 48px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch}.d::after,.d::before{display:block;content:"";padding-right:var(--i)}.e,.f{flex:none;--b:700}.e{display:block;font-size:24px;line-height:18px;letter-spacing:-1px;text-transform:lowercase;border-top:4px solid;padding:6px 4px 0 0}a.e{color:currentColor;text-decoration:none}.f{margin:0 0 0 24px;font-size:6px;line-height:10px;letter-spacing:1px;text-transform:uppercase;width:0}.g{margin-left:auto}.h{flex:none;display:block;margin:10px 24px 0 0;font-size:14px;color:var(--d);--b:600;line-height:18px}.h:last-child{margin-right:0}a.i,a.i.j{color:var(--d)}a.i{display:block;cursor:pointer;font-size:16px;min-width:125px;margin:0 auto;padding:13px;text-decoration:none;border:1px solid var(--d);border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}a.i.j{background-color:var(--a);border-color:var(--a)}#isso-thread input[type=button]:hover,#isso-thread input[type=submit]:hover,a.i:hover{transform:translate(-2px,-2px);box-shadow:2px 2px 1px var(--g)}#isso-thread input[type=button]:active,#isso-thread input[type=submit]:active,a.i:active{transform:translate(0,0);box-shadow:inset 0 0 7px var(--g)}@media (min-width:768px){:root{--i:64px}}@media (min-width:1024px){:root{--i:128px}}.k:before{content:'\f16d'}.l:before{content:'\f300'}.n:before{content:'\f167'}.m:before{content:'\f30c'}:root{--i:max(12px, (100vw - var(--j)) / 2);--j:800px}h1{margin:48px 0 32px;font-size:36px;line-height:48px;letter-spacing:-.8px}h2,h3{margin:42px 0 18px}h1,h2{font-weight:700}h2{font-size:26px;line-height:34px;letter-spacing:-.3px}h3{font-size:22px;line-height:30px;letter-spacing:-.18px}p{margin:18px 0}p>code{word-break:break-all}blockquote code,em>code{font-style:normal}.o a,h3,strong{font-weight:600}ul.o{margin:24px 0;padding-left:32px;margin-left:calc(-32*min(max(var(--i) - 32px,0px),1px))}.o a{color:var(--d)}.o li{display:flex;flex-direction:row;position:relative;list-style:none;margin:2px 0 30px}.o picture{margin-top:5px;margin-right:20px}.o picture *{border-radius:5px}#isso-thread #isso-root .L,.p,.t .v>div{margin:0}.q{font-size:16px;margin:5px 0}i{font-size:14px}blockquote{line-height:32px;font-weight:300;font-style:italic}table{margin:24px;border-collapse:separate;border-spacing:12px 0}thead th{border-bottom:var(--k) solid;--b:600;text-align:left}code,pre code{background-color:var(--e)}code{font-size:.9em;font-family:monospace;padding:1px 5px;border:1px dotted var(--c);border-radius:4px}pre code{display:block;width:100vw;margin:48px calc(-1*var(--i));padding:18px var(--i);border-width:0;border-radius:0;overflow-x:scroll}video{display:block;max-width:100%;margin:32px auto}iframe{width:calc(var(--l)*1);height:calc(var(--l)*.66);border:1px solid rgba(0,0,0,.1);--l:calc(100vw - 2 * var(--i))}.r,blockquote{color:#9e9e9e}.s{cursor:pointer}.t{display:flex;flex-wrap:wrap-reverse}.t .u>p{padding-top:0;margin-top:0}.t .v .w{margin-bottom:7px}.t .u{flex:1;margin-right:15px;width:400px}.t .v{padding:17px;background-color:var(--e);border-radius:4px;overflow:hidden;max-width:350px}.t .v h2{color:var(--d);margin:0 0 10px}.t .v>div div{margin-left:20px}.t .v>div a{display:block;text-decoration:none}.t .v,.x{box-shadow:7px 10px 15px rgba(10,10,10,.2)}.x .y{height:10px;width:10px;border-radius:50%;border:1px solid #000;position:relative;top:6px;left:6px;background-color:#ff3b47;border-color:#9d252b;display:inline-block;vertical-align:top}.y.z{left:11px;background-color:#ffc100;border-color:#9d802c}.y.A{left:16px;background-color:#00d742;border-color:#049931}.x .B{position:relative;width:100%;height:25px;background-color:#bbb;margin:0 auto;border-top-right-radius:5px;border-top-left-radius:5px}.x .C,.x .D{display:inline-block}.x .C{position:absolute}.x .D{color:#333;width:100%;padding:0;margin:0;text-align:center;font-size:12px;font-weight:700;vertical-align:top;line-height:25px}.x .E{background-color:#000;color:#fff;box-sizing:border-box;width:100%;margin:0 auto;padding:20px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;font-size:16px}.x .F{font-family:monospace!important;padding:0;margin:0}.x .G{color:var(--c);font-weight:700;margin-right:7px}.x .H{background-color:#fff}.x i{color:#666}#isso-thread h4{display:none}#isso-thread input[type=button],#isso-thread input[type=submit]{cursor:pointer;font-size:16px;width:125px;margin:0 auto;color:var(--d);padding:13px;text-decoration:none;border:1px solid #fff;border-radius:6px;background-color:transparent;outline:0;height:44px;max-height:44px;min-height:44px;line-height:14px;transform:translate(0,0);transition:all;transition-duration:123ms}#isso-thread input[type=submit]{background-color:var(--a);border-color:var(--a);color:#fff}#isso-thread input[type=checkbox]{margin-right:6px}#isso-thread>div>div>div>div,.x .H{color:#000}#isso-thread code,#isso-thread label{color:#fff}#isso-thread h1,#isso-thread h2,#isso-thread h3,#isso-thread h4,#isso-thread h5,#isso-thread h6{margin:0;line-height:1em}#isso-thread h1{font-size:2em}#isso-thread h2{font-size:1.6}#isso-thread h3{font-size:1.2}#isso-thread input[type=email],#isso-thread input[type=text]{margin-bottom:15px;padding:10px 0 10px 10px;background-color:transparent;border:0;border-bottom:1px solid #fff;border-radius:0;outline-color:var(--g);color:#fff;margin-right:10px}#isso-thread .I::placeholder,#isso-thread input[type=email]::placeholder,#isso-thread input[type=text]::placeholder{color:#bbb}#isso-thread .I::active,#isso-thread .I:focus,#isso-thread input[type=email]:active,#isso-thread input[type=email]:focus,#isso-thread input[type=text]:active,#isso-thread input[type=text]:focus{border-color:var(--a)!important}#isso-thread input[name=website]{display:none}#isso-thread .J{margin-top:30px}#isso-thread .J>.K{padding-right:15px}#isso-thread preview{background:0 0;border:0;box-shadow:none}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{min-height:100px!important;font-size:14px}#isso-thread #isso-root b,#isso-thread #isso-root h1,#isso-thread #isso-root h2,#isso-thread #isso-root h3,#isso-thread #isso-root i,#isso-thread #isso-root p,#isso-thread #isso-root strong{color:var(--d)}#isso-thread>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type>div:first-of-type{max-height:1.5em}#isso-thread #isso-root .M{color:#fff!important}.N h2{margin-bottom:0;padding-bottom:0}.N p{margin-top:0}.N i{font-size:14px}@media (min-width:768px){a,p>code{word-break:initial}}@media (max-width:484px){.o li{flex-direction:column}.o li img{width:100%}.o{padding:0 15px!important}.o picture{margin-bottom:10px;margin-right:0}.c{margin-left:0;margin-right:8px}}.R,.S{color:#a0a1a7;font-style:italic}.T,.U,.V{color:#a626a4}.W,.X,.Y,.Z,._{color:#e45649}.-a{color:#0184bb}.-b,.-c,.-d,.-e,.-f{color:#50a14f}.-g,.-h .-i{color:#c18401}.-j,.-k,.-l,.-m,.-n,.-o,.-p,.-q{color:#986801}.-i,.-r,.-s,.-t,.-u,.-v{color:#4078f2}.-w{font-style:italic}.-x{font-weight:700}.-t{text-decoration:underline}@media (prefers-color-scheme:dark){.R,.S{color:#5c6370;font-style:italic}.T,.U,.V{color:#c678dd}.W,.X,.Y,.Z,._{color:#e06c75}.-a{color:#56b6c2}.-b,.-c,.-d,.-e,.-f{color:#98c379}.-g,.-h .-i{color:#e6c07b}.-j,.-k,.-l,.-m,.-n,.-o,.-p,.-q{color:#d19a66}.-i,.-r,.-s,.-t,.-u,.-v{color:#61aeee}.-w{font-style:italic}.-x{font-weight:700}.-t{text-decoration:underline}}.-y{padding:0 8px;vertical-align:top;cursor:pointer;color:var(--a)}.-y:hover{text-decoration:underline}.-z{position:absolute;opacity:0;color:#fff;font-weight:700;background-color:var(--a);padding:5px 10px;margin-left:10px;border-radius:6px;font-size:14px;transition:123ms}</style><script defer="">document.documentElement.style.setProperty("--k",1/(window.devicePixelRatio||1)+"px");</script></head><body><div class="d"><a href="/" class="e">Blocs<br/>.fr</a><div class="f">Site</div><a href="/" class="h">Home</a><div class="f g">Cool</div><a href="/blog" class="h">Blog</a><a href="#" class="h" id="theme-switch"></a></div><div class="t"><div class="u"><p>Vous avez un n≈ìud Bitcoin et Lightning Network, vous participez √† la d√©centralisation du r√©seau, bravo ! Cependant il r√©side un point noir, en particulier si votre noeud est localis√© chez vous ou votre bureau... En connaissant votre adresse IP, publi√©e par le n≈ìud, il est possible de vous localiser. C&#x27;est sensible dans le cas o√π vous y mettez pour l&#x27;√©quivalent de milliers d&#x27;euros en bitcoins, une personne mal intentionn√©e pourrait vous pirater voire vous cambrioler. Heureusement, gr√¢ce √† Tor vous allez pouvoir cacher tout cela en un temps record</p></div><div class="v"><h2>Sommaire</h2><div class="w"><a href="#quest-ce-que-tor--pourquoi-tor-">Qu&#x27;est ce que Tor ? Pourquoi Tor ?</a></div><div class="w"><a href="#installer-et-activer-tor">Installer et activer Tor</a></div><div class="w"><a href="#configurer-tor">Configurer Tor</a></div><div class="w"><a href="#connecter-votre-bitcoin--tor">Connecter votre Bitcoin √† Tor</a></div><div class="w"><a href="#connecter-votre-lightning--tor">Connecter votre Lightning √† Tor</a><div><div class=""><a href="#g%C3%A9rer-les-droits-avec-tor">G√©rer les droits avec Tor</a></div></div></div></div></div><p><em>Ce guide est bas√© sur une installation avec <code>bitcoind</code> et <code>lnd</code> sur un Debian 9 Stretch  Lite, sur n‚Äôimporte quelle version Debian 9 ce guide sera fonctionnel.</em></p><h2 id="quest-ce-que-tor--pourquoi-tor-" class="P"><a href="#quest-ce-que-tor--pourquoi-tor-" class="c">¬ß</a>Qu‚Äôest ce que Tor ? Pourquoi Tor ?</h2><p>Vous connaissez peut-√™tre Tor indirectement en citant le ¬´ Deep Web ¬ª, mais c‚Äôest bien plus que cela. Tor est un logiciel libre qui permet de brouiller les communications Internet (TCP) en construisant un circuit de routage IP. En d‚Äôautres termes un √©metteur communique avec un r√©cepteur en passant par un chemin incompr√©hensible, la communication devient intra√ßable d‚Äôun point de vue ext√©rieur.</p><p>Autant vous dire que Tor est la solution propice √† anonymiser les communications de votre n≈ìud Bitcoin.</p><blockquote><p>Tor tord le chemin.</p></blockquote><h2 id="installer-et-activer-tor" class="P"><a href="#installer-et-activer-tor" class="c">¬ß</a>Installer et activer Tor</h2><p>On va travailler avec le terminale de commandes, si vous avez la version Lite, vous n‚Äôavez que cela sous la main en principe.</p><p>Installer Tor se fait avec la commande <code>apt update &amp;&amp; apt install tor</code>, on met √† jour <code>apt</code> pour √™tre s√ªr de t√©l√©charger la derni√®re version des d√©pendances.</p><p>Une fois install√© activez le service en tapant <code>systemctl enable tor</code> et <code>systemctl start tor</code>.</p><h2 id="configurer-tor" class="P"><a href="#configurer-tor" class="c">¬ß</a>Configurer Tor</h2><p>On a install√© Tor, nous allons le configurer en pr√©vision des usages avec <code>lnd</code> et <code>bitcoind</code>.</p><p>La configuration de Tor se trouve dans le chemin <code>/etc/tor/torrc</code> o√π <code>torrc</code> est un fichier de configuration. Connectez-vous en <code>root</code> pour le modifier avec <code>su root</code>, puis tapez <code>vim /etc/tor/torrc</code> ou <code>nano /etc/tor/torrc</code> si vous pr√©f√©rez <code>nano</code> pour √©diter un fichier. Je vous montre les configurations √† d√©commenter (en retirant le # au d√©but de chaque ligne concern√©e).</p><pre><code>ControlPort 9051

CookieAuthentication 1

HiddenServiceDir /var/lib/tor/bitcoin/ # Emplacement du dossier de votre routage
HiddenServicePort 8333 127.0.0.1:8333 # Routage bitcoin (8333 est le port mainnet de Bitcoin)
HiddenServicePort 8332 [::1]:8332 # Routage bitcoin ipv6
</code></pre><p>Modifications faites, tapez <code>systemctl restart tor</code> pour red√©marrer Tor afin qu‚Äôil prenne en compte vos modifications.</p><p>Et enfin pour voir si Tor est fonctionnel, observez le avec la commande <code>systemctl status tor@default</code>, vous devriez avec quelque chose comme suit :</p><div class="x"><div class="B"><div class="C"><div class="y -A"></div><div class="y z"></div><div class="y A"></div></div><p class="D">Voir le status de Tor</p></div><div class="E"><div class="F"><span class="G">root@raspberry:~ $</span><span class="-y cliboard-action-selector" data-value="geznr23bzo_0">üìã</span><span id="geznr23bzo_0">systemctl status tor</span><span id="geznr23bzo_0_copy-result" class="-z">C&#x27;est copi√© !</span><div>‚óè tor@default.service - Anonymizing overlay network for TCP</div><div>Loaded: loaded (/lib/systemd/system/tor@default.service; static; vendor preset: enabled)</div><div>Active: active (running) since Wed 2020-01-01 10:09:09 UTC; 7h ago</div><div>Process: 1805 ExecReload=/bin/kill -HUP ${MAINPID} (code=exited, status=0/SUCCESS)</div><div>Process: 2259 ExecStartPre=/usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0 --verify-config (code=exited, status=0/SUCCESS</div><div>Process: 2257 ExecStartPre=/usr/bin/install -Z -m 02755 -o debian-tor -g debian-tor -d /var/run/tor (code=exited, status=0/SUCCESS)</div><div>Main PID: 2262 (tor)</div><div>CGroup: /system.slice/system-tor.slice/tor@default.service</div><div>&nbsp;&nbsp;&nbsp;‚îî‚îÄ2262 /usr/bin/tor --defaults-torrc /usr/share/tor/tor-service-defaults-torrc -f /etc/tor/torrc --RunAsDaemon 0</div><div></div><div>Jan 01 10:09:05 raspberrypi tor[2259]: Jan 01 10:09:05.113 [notice] Read configuration file /usr/share/tor/tor-service-defaults-torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2259]: Jan 01 10:09:05.113 [notice] Read configuration file /etc/tor/torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2259]: Configuration was valid</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Tor 0.2.9.16 (git-9ef571339967c1e5) running on Linux with Libevent 2.0.21-stable, OpenSSL 1.1.0j and Zlib 1.2.8.</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Tor can't help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warn</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Read configuration file /usr/share/tor/tor-service-defaults-torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.979 [notice] Read configuration file /etc/tor/torrc.</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.995 [notice] Opening Socks listener on 127.0.0.1:9050</div><div>Jan 01 10:09:05 raspberrypi tor[2262]: Jan 01 10:09:05.995 [notice] Opening Control listener on 127.0.0.1:9051</div><div>Jan 01 10:09:09 raspberrypi systemd[1]: Started Anonymizing overlay network for TCP.</div></div></div></div><p>Si votre service Tor n‚Äôest pas actif, vous trouverez des informations en tapant <code>journalctl -u tor@default</code>.</p><h2 id="connecter-votre-bitcoin--tor" class="P"><a href="#connecter-votre-bitcoin--tor" class="c">¬ß</a>Connecter votre Bitcoin √† Tor</h2><p>Cette configuration fonctionne avec <code>bitcoind</code> en version <code>0.19.0.1</code>, dans mon n≈ìud j‚Äôutilise l‚Äôutilisateur <code>bitcoin</code> pour g√©rer ce service, je vous d√©conseille d‚Äôutiliser <code>root</code>.</p><p>Avant de commencer vous allez devoir chercher votre nom de domaine Tor en tapant ce qui suit :</p><div class="x"><div class="B"><div class="C"><div class="y -A"></div><div class="y z"></div><div class="y A"></div></div><p class="D">Voir le status de Tor</p></div><div class="E"><div class="F"><span class="G">bitcoin@raspberry:~ $</span><span class="-y cliboard-action-selector" data-value="gvohg5eble_0">üìã</span><span id="gvohg5eble_0">cat /var/lib/tor/bitcoin/hostname</span><span id="gvohg5eble_0_copy-result" class="-z">C&#x27;est copi√© !</span><div>blocsiq5epwbye47.onion</div></div></div></div><p><code>blocsiq5epwbye47.onion</code> est mon nom de domaine (hostname).</p><blockquote><p>Si vous voulez savoir comment avoir un domaine qui commence par un mot ou pseudo comme ici ‚Äúblocs‚Äù, laissez un commentaire plus bas.</p></blockquote><p>Pour configurer Bitcoin vous allez modifier <code>.bitcoin/bitcoin.conf</code> avec les informations suivantes :</p><pre><code># Vos configurations
# ...
# Ajoutez ou modifiez ce qui suit

proxy=127.0.0.1:9050 # Proxy sur le service Tor
externalip=blocsiq5epwbye47.onion # √† remplacer par votre hostname, c&#x27;est l&#x27;adresse affich√©e aux autres n≈ìuds du r√©seau
</code></pre><p>Red√©marrez Bitcoin en tapant <code>bitcoin-cli stop &amp;&amp; bitcoind</code>.</p><p>F√©licitations votre n≈ìud est d√©sormais sur le r√©seau Tor. Il ne vous reste plus qu‚Äô√† faire de m√™me sur LND afin d‚Äôanonymiser nos √©changes sur le r√©seau Lightning Network.</p><h2 id="connecter-votre-lightning--tor" class="P"><a href="#connecter-votre-lightning--tor" class="c">¬ß</a>Connecter votre Lightning √† Tor</h2><p>La configuration de <code>lnd</code> est un peu diff√©rente de Bitcoin. Sans plus attendre ouvrez <code>.lnd/lnd.conf</code> et ajoutez ces diff√©rentes configurations :</p><pre><code># Vos configurations
# ...
# Ajoutez ou modifiez ce qui suit

listen=localhost # Important pour √©viter d&#x27;ouvrir votre IP
externalip=blocsiq5epwbye47.onion # Votre hostname Tor
nat=false # A d√©sactiver pour √©viter d&#x27;associer votre adresse IP √† votre n≈ìud

[tor]
tor.active=1
tor.socks=9050
tor.privatekeypath=/var/lib/tor/bitcoin/private_key
</code></pre><p>Red√©marrez votre <code>lnd</code> en tapant <code>lncli stop</code> et <code>lnd</code> pour lancer le service.</p><p>Il se peut que vous ayez une erreur de droit relative √† Tor. Dans la partie suivante on voit comment la solutionner.</p><h3 id="g%C3%A9rer-les-droits-avec-tor" class="P"><a href="#g%C3%A9rer-les-droits-avec-tor" class="c">¬ß</a>G√©rer les droits avec Tor</h3><p>Vous devez donner acc√®s √† diff√©rents fichiers de Tor √† l‚Äôutilisateur qui g√®re votre <code>lnd</code>, dans mon cas mon utilisateur est <code>bitcoin</code>.</p><p>Tapez la commande <code>chmod -R 0750 /var/lib/tor</code>. Cela va donner acc√®s en lecture au groupe <code>debian-tor</code> sur le dossier <code>/var/lib/tor</code>.</p><p>Maintenant ajoutez l‚Äôutilisateur <code>bitcoin</code> au groupe <code>debian-tor</code> en tapant <code>usermod -a -G debian-tor bitcoin</code> en √©tant connect√© sur <code>su root</code>.</p><blockquote><p>Tor est bien con√ßu, il ne nous permet pas d‚Äôappliquer les droits qu‚Äôon veut √† ses dossiers pour limiter de trop les ouvrir. Tapez <code>journalctl -u tor@default</code>, si les derni√®res lignes parlent d‚Äôune erreur, cela signifie que votre Tor n‚Äôest plus en route. C‚Äôest un g√©n√©ral d√ª √† une mauvaise configuration (mauvais droits sur les dossiers relatifs √† Tor, mauvaises configuration dans <code>torrc</code>, etc.)</p></blockquote><hr/><p>A partir d‚Äôici votre n≈ìud est connect√© au r√©seau en passant par Tor ! Il est toujours int√©ressant d‚Äôobserver si tout est bien cadr√© par Tor afin de ne pas avoir de fuite d‚ÄôIP. Tapez la commande du terminal ci-dessous :</p><div class="x"><div class="B"><div class="C"><div class="y -A"></div><div class="y z"></div><div class="y A"></div></div><p class="D">Observer les ports d&#x27;√©coute</p></div><div class="E"><div class="F"><span class="G">root@raspberry:~ $</span><span class="-y cliboard-action-selector" data-value="g6vcrb74xk_0">üìã</span><span id="g6vcrb74xk_0">netstat -tulpn</span><span id="g6vcrb74xk_0_copy-result" class="-z">C&#x27;est copi√© !</span><div>(Not all processes could be identified, non-owned process info</div><div>will not be shown, you would have to be root to see it all.)</div><div>Active Internet connections (only servers)</div><div>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</div><div>tcp        0      0 127.0.0.1:9735          0.0.0.0:*               LISTEN      2043/lnd</div><div>tcp        0      0 127.0.0.1:28332         0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:8332          0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:8333          0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:28333         0.0.0.0:*               LISTEN      653/bitcoind</div><div>tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      2043/lnd</div><div>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</div><div>tcp        0      0 127.0.0.1:10009         0.0.0.0:*               LISTEN      2043/lnd</div><div>tcp        0      0 127.0.0.1:9050          0.0.0.0:*               LISTEN      -</div><div>tcp        0      0 127.0.0.1:9051          0.0.0.0:*               LISTEN      -</div><div>tcp6       0      0 ::1:8332                :::*                    LISTEN      653/bitcoind</div><div>tcp6       0      0 :::80                   :::*                    LISTEN      -</div><div>tcp6       0      0 :::22                   :::*                    LISTEN      -</div><div>udp        0      0 0.0.0.0:48138           0.0.0.0:*                           -</div><div>udp        0      0 0.0.0.0:68              0.0.0.0:*                           -</div><div>udp        0      0 0.0.0.0:5353            0.0.0.0:*                           -</div><div>udp6       0      0 :::45175                :::*                                -</div><div>udp6       0      0 :::5353                 :::*                                -</div></div></div></div><p>Nous, ce qui nous int√©resse ce sont <code>bitcoind</code> et <code>lnd</code>. On va passer tous les ports d‚Äô√©coute en revue et comprendre si oui ou non ils sont ‚Äútorrifi√©s‚Äù :</p><ul><li><code>lnd 9735</code> : C‚Äôest le port de LND, ‚Äútorrifi√©e‚Äù avec le cl√© priv√©e de votre Tor ;</li><li><code>bitcoind 28332</code> : C‚Äôest le port <a href="https://zeromq.org/" class="-B" target="_blank">ZMQ</a> de Bitcoin, il sert √† la configuration et n‚Äôest pas distribu√© ;</li><li><code>bitcoind 8333</code> : C‚Äôest le port de <code>bitcoind</code> qui est cach√© via Tor (HiddenServicePort dans <code>/etc/tor/torrc</code>) ;</li><li><code>bitcoind 8332</code> : C‚Äôest le port JSON-RPC de <code>bitcoind</code>, nul besoin de le cacher avec Tor si vous ne le distribuez pas ;</li><li><code>bitcoind 8332 IPV6</code> : C‚Äôest le port ipv6 de <code>bitcoind</code> qui est cach√© via Tor (HiddenServicePort dans <code>/etc/tor/torrc</code>) ;</li></ul><p>Enfin pour voir si <code>lnd</code> a bien consid√©r√© vos modifications, tapez <code>lncli getinfo</code>, vous obtenez un JSON comme suit :</p><pre><code>{
    &quot;version&quot;: &quot;0.8.0-beta commit=v0.8.1-beta&quot;,
    &quot;identity_pubkey&quot;: &quot;03a2c34daf010b3501daf704b5a321e82e1631421b7ffa18dd49014967eda82dc9&quot;,
    &quot;alias&quot;: &quot;blocs.fr&quot;,
    &quot;color&quot;: &quot;#00aaff&quot;,
    &quot;num_pending_channels&quot;: 0,
    &quot;num_active_channels&quot;: 6,
    &quot;num_inactive_channels&quot;: 0,
    &quot;num_peers&quot;: 6,
    &quot;block_height&quot;: 610817,
    &quot;block_hash&quot;: &quot;0000000000000000000ff1cf20075afd0df2a52288edd20a7d1cd8a51ca3e32a&quot;,
    &quot;best_header_timestamp&quot;: 1577900732,
    &quot;synced_to_chain&quot;: true,
    &quot;synced_to_graph&quot;: true,
    &quot;testnet&quot;: false,
    &quot;chains&quot;: [
        {
            &quot;chain&quot;: &quot;bitcoin&quot;,
            &quot;network&quot;: &quot;mainnet&quot;
        }
    ],
    &quot;uris&quot;: [
        &quot;03a2c34daf010b3501daf704b5a321e82e1631421b7ffa18dd49014967eda82dc9@blocsiq5epwbye47.onion:9735&quot;
    ]
}
</code></pre><p>Int√©ressez vous √† la partie d‚Äôen bas, <code>&quot;uris&quot;</code>, qui est une liste des adresses distribu√©es dans le r√©seau. Ici je n‚Äôai qu‚Äôune adresse qui est un .onion, voir ce qui suit le ‚Äù@‚Äú. La partie de gauche est la cl√© publique de mon lnd.</p><blockquote><p>.onion est un nom de domaine exclusif au routage en oignon comme le fait Tor. Comme vous pouvez l‚Äôimaginer, c‚Äôest r√©ellement une r√©f√©rence √† la plante. Cela vient du routage qui recouvre le message de plusieurs couches, comme un oignon o√π le coeur est enrob√© de plusieurs couches. <a href="https://www.youtube.com/watch?v=zjqw1VnuKLs" class="-B" target="_blank">MrBidouille en a fait une parfaite vid√©o introductive</a>.</p></blockquote><p>V√©rifications faites, vous √™tes cach√©s, bravo !</p><p>Merci √† <a href="https://twitter.com/clint_network">Clint</a> pour ses infos sur Tor et <a href="https://twitter.com/JohnOnChain">JohnOnChain</a> pour m‚Äôavoir aid√© √† la configuration de lnd avec Tor.</p><span class="r">Modifi√© le  <time dateTime="2020-01-01T00:00:00.000Z">mercredi 1 janvier 2020</time></span><section class="Q"><p><i>Cet article est sous license <a href="https://creativecommons.org/licenses/?lang=fr-FR" target="_blank">Creative Commons BY-NC-SA</a>. Il est ouvert √† contribution en vous rendant sur ce lien : <a href="https://github.com/Chaine-de-Blocs/blocs.fr/blob/master/posts/2020-01-01-bitcoin-et-lightning-anonyme-avec-tor.mdx" target="_blank">Servir Bitcoin et Lightning Network en √©tant anonyme avec Tor</a></i></p></section><script type="text/javascript" data-isso="https://isso.blocs.fr/" src="//isso.blocs.fr/js/embed.min.js" data-isso-css="true" data-isso-lang="fr" data-isso-reply-notifications="true" async=""></script><div class="N"><h2>Commentaires</h2><p><i>(Le format <a href="https://www.christopheducamp.com/2014/09/18/love-markdown/" target="_blank">Markdown</a> est accept√©)</i></p><section id="isso-thread"></section></div></body></html>